# SecureBot用Telegramボットのセットアップガイド

このガイドでは、Telegramボットを作成し、SecureBotで使用するための設定プロセスをご案内します。

## BotFatherを使ったボットの作成

1. **Telegramを開き**、`@BotFather`を検索するか、このリンクをクリックしてください：[BotFather](https://t.me/botfather)

2. **BotFatherとの会話を開始**するために「開始」をクリックするか、`/start`を送信してください

3. **新しいボットを作成**するために、次のコマンドを送信します：
   ```
   /newbot
   ```

4. **ボットの名前を選択**してください。これは会話で表示される表示名です（例：「SecureBotセキュリティモニター」）

5. **ボットのユーザー名を選択**してください。これは「bot」で終わる必要があり、一意である必要があります（例：「your_security_bot」や「your_company_securebot」）

6. **APIトークンを保存してください！** BotFatherは次のようなAPIトークンを提供します：
   ```
   123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ
   ```
   このトークンはSecureBotの設定に不可欠であり、安全に保管する必要があります。

## チャットIDの取得

### 方法1：@userinfobot を使用する

1. Telegramで`@userinfobot`を検索し、会話を開始します
2. ボットは自動的にあなたのアカウント情報（チャットIDを含む）を返信します

### 方法2：@RawDataBot を使用する

1. Telegramで`@RawDataBot`を検索し、会話を開始します
2. ボットはあなたの情報を含むJSONメッセージを送信します
3. 「from」セクションの `"id"` フィールドを探して、あなたのチャットIDを見つけてください

### 方法3：グループチャットの場合

グループで通知を受け取りたい場合：

1. 新しいボットをグループに追加します
2. グループでメッセージを送信します
3. ブラウザで次のURLを訪問します（あなたのボットトークンに置き換えてください）：
   ```
   https://api.telegram.org/bot<あなたのボットトークン>/getUpdates
   ```
4. レスポンスの中で `"chat":{"id":-123456789,` を探します。グループチャットIDは通常、負の数値であることに注意してください

## ボット権限の設定

セキュリティを向上させるため、BotFatherでこれらの設定を行ってください：

1. BotFatherで `/mybots` コマンドを使用します
2. 新しく作成したボットを選択します
3. 「Bot Settings」 > 「Group Privacy」をクリックします
4. ボットがグループ内のすべてのメッセージを見る必要がある場合は「Disable」を選択し、ボットに向けられたコマンドのみを見る必要がある場合は「Enable」（推奨）を維持します
5. ボット設定メニューからボットの説明と概要セクションを設定することもできます

## SecureBotに管理者/閲覧者権限を追加する

1. 管理者と閲覧者のTelegramユーザーIDを確認します
2. SecureBot設定ファイルを編集します（直接またはAnsibleを介して）：

```toml
[telegram]
bot_token = "あなたのボットトークン"  # BotFatherからのトークン
chat_id = "あなたのチャットID"       # あなたのユーザーIDまたはグループチャットID
admin_users = [123456789]          # 管理者のユーザーID
viewer_users = [987654321]         # 閲覧者のユーザーID
```

## ボット設定のテスト

1. ボットトークンとチャットIDでSecureBotを設定した後、SecureBotサービスを開始します：
   ```bash
   sudo systemctl start securebot
   ```

2. Telegramクライアントを開き、ボットに次のメッセージを送信します：
   ```
   /start
   ```

3. すべてが正しく設定されていれば、ボットはウェルカムメッセージで応答するはずです

4. 基本コマンドをテストします：
   ```
   /help
   /status
   ```

## トラブルシューティング

ボットが応答しない場合：

1. SecureBotのログを確認します：
   ```bash
   sudo journalctl -u securebot
   ```

2. 設定ファイルでボットトークンが正しいことを確認します
   
3. SecureBotサービスが実行中であることを確認します：
   ```bash
   sudo systemctl status securebot
   ```

4. Telegramユーザーが設定で正しく管理者または閲覧者として設定されていることを確認します

5. グループで使用している場合、ボットに十分な権限があることを確認します

## セキュリティに関する考慮事項

- ボットトークンを公開しないでください
- トークンが漏洩した可能性がある場合は、定期的に更新してください
- 信頼できるユーザーのみをadmin_usersリストに追加してください
- 公開チャンネルではなく、プライベートグループにボットを制限することを検討してください

## 次のステップ

Telegramボットの設定に成功したら、SecureBotの設定ファイルでモニタリング設定を構成して、セキュリティ通知の受信を開始します。
