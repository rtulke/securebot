# Настройка Telegram-бота для SecureBot

Это руководство проведет вас через процесс создания Telegram-бота и его настройки для использования с SecureBot.

## Создание бота с помощью BotFather

1. **Откройте Telegram** и найдите `@BotFather` или перейдите по этой ссылке: [BotFather](https://t.me/botfather)

2. **Начните разговор** с BotFather, нажав "Старт" или отправив `/start`

3. **Создайте нового бота**, отправив команду:
   ```
   /newbot
   ```

4. **Выберите имя** для вашего бота при запросе. Это отображаемое имя, которое будет появляться в разговорах (например, "SecureBot Монитор Безопасности")

5. **Выберите имя пользователя** для вашего бота при запросе. Оно должно заканчиваться на "bot" и быть уникальным (например, "ваш_безопасность_bot" или "ваша_компания_securebot")

6. **Сохраните свой API-токен!** BotFather предоставит вам API-токен, который выглядит примерно так:
   ```
   123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ
   ```
   Этот токен критически важен для настройки SecureBot и должен храниться в безопасности.

## Получение вашего Chat ID

### Метод 1: Использование @userinfobot

1. Найдите `@userinfobot` в Telegram и начните разговор
2. Бот автоматически ответит информацией о вашей учетной записи, включая ваш Chat ID

### Метод 2: Использование @RawDataBot

1. Найдите `@RawDataBot` в Telegram и начните разговор
2. Бот отправит вам сообщение в формате JSON, содержащее вашу информацию
3. Ищите поле `"id"` в разделе "from", чтобы найти ваш Chat ID

### Метод 3: Для групповых чатов

Если вы хотите получать уведомления в группе:

1. Добавьте вашего нового бота в группу
2. Отправьте сообщение в группе
3. Посетите следующий URL в вашем браузере (замените на токен вашего бота):
   ```
   https://api.telegram.org/bot<ВашТОКЕНбота>/getUpdates
   ```
4. Ищите `"chat":{"id":-123456789,` в ответе. Обратите внимание, что ID групповых чатов обычно отрицательные числа

## Настройка разрешений бота

Для лучшей безопасности вы должны настроить эти параметры с помощью BotFather:

1. Используйте команду `/mybots` в BotFather
2. Выберите вашего только что созданного бота
3. Нажмите "Bot Settings" > "Group Privacy"
4. Выберите "Disable", если ваш бот должен видеть все сообщения в группе, или оставьте "Enable" (рекомендуется), если ему нужно видеть только команды, адресованные ему
5. Вы также можете установить описание и раздел "о боте" через меню настроек бота

## Добавление разрешений администратора/наблюдателя в SecureBot

1. Определите ID пользователей Telegram для администраторов и наблюдателей
2. Отредактируйте файл конфигурации SecureBot (напрямую или через Ansible):

```toml
[telegram]
bot_token = "ВАШ_ТОКЕН_БОТА"  # Токен от BotFather
chat_id = "ВАШ_CHAT_ID"       # Ваш ID пользователя или ID группового чата
admin_users = [123456789]     # ID пользователей-администраторов
viewer_users = [987654321]    # ID пользователей-наблюдателей
```

## Тестирование конфигурации вашего бота

1. После настройки SecureBot с вашим токеном бота и Chat ID, запустите службу SecureBot:
   ```bash
   sudo systemctl start securebot
   ```

2. Откройте ваш клиент Telegram и отправьте следующее сообщение вашему боту:
   ```
   /start
   ```

3. Ваш бот должен ответить приветственным сообщением, если все настроено правильно

4. Протестируйте основные команды:
   ```
   /help
   /status
   ```

## Устранение неполадок

Если ваш бот не отвечает:

1. Проверьте логи SecureBot:
   ```bash
   sudo journalctl -u securebot
   ```

2. Убедитесь, что токен вашего бота правильный в файле конфигурации
   
3. Убедитесь, что служба SecureBot запущена:
   ```bash
   sudo systemctl status securebot
   ```

4. Проверьте, что ваш ID пользователя Telegram правильно установлен как администратор или наблюдатель в конфигурации

5. Убедитесь, что у вашего бота достаточно разрешений, если он используется в группе

## Соображения безопасности

- Никогда не делитесь токеном вашего бота публично
- Регулярно меняйте токен вашего бота, если подозреваете, что он мог быть скомпрометирован
- Добавляйте только доверенных пользователей в список admin_users
- Рассмотрите возможность ограничения бота частной группой, а не использования его в публичных каналах

## Следующие шаги

После успешной настройки вашего Telegram-бота, перейдите к настройке параметров мониторинга в файле конфигурации SecureBot, чтобы начать получать уведомления о безопасности.
